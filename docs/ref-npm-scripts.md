# npm-скрипты

Описание команд из `package.json` scripts: назначение и рекомендации по использованию.

## Разработка

| Команда | Описание | Когда использовать |
|---------|----------|-------------------|
| `npm run dev` | Запускает Vite dev-сервер с HMR | Ежедневная разработка, локальный запуск приложения |
| `npm run preview` | Запускает локальный сервер для просмотра production-сборки | Проверка билда перед деплоем, отладка production-режима |

## Сборка

| Команда | Описание | Когда использовать |
|---------|----------|-------------------|
| `npm run build` | `vue-tsc -b && vite build` — проверка типов + production-сборка | CI/CD, деплой, финальная проверка перед релизом |
| `npm run build:analyze` | Сборка с `rollup-plugin-visualizer` → `stats.html` | Анализ размера бандла, поиск тяжёлых зависимостей |

## Качество кода

| Команда | Описание | Когда использовать |
|---------|----------|-------------------|
| `npm run lint` | ESLint по всему проекту | CI, pre-commit, проверка перед PR |
| `npm run lint:fix` | ESLint с автоисправлением | Быстрое исправление большинства замечаний |
| `npm run format` | Prettier — форматирует все файлы | Перед коммитом, после merge |
| `npm run format:check` | Prettier — проверка без изменений | CI, проверка соответствия стилю |

## Тестирование

| Команда | Описание | Когда использовать |
|---------|----------|-------------------|
| `npm run test` | Vitest — watch-режим для unit/component тестов | Разработка, TDD |
| `npm run test:run` | Vitest — однократный прогон | CI, pre-commit |
| `npm run test:coverage` | Vitest с отчётом покрытия (text, html, lcov) | Анализ покрытия, отчёты в PR |
| `npm run test:e2e` | Playwright — E2E тесты | CI, проверка критических сценариев |
| `npm run test:e2e:ui` | Playwright UI mode | Отладка E2E, разработка новых тестов |

## Ресурсы и документация

| Команда | Описание | Когда использовать |
|---------|----------|-------------------|
| `npm run fonts` | Скачивает Onest webfonts из GitHub в `public/fonts/onest/` | Первоначальная настройка, обновление шрифтов |
| `npm run docs:api` | TypeDoc → генерирует API-документацию в `docs/api/` | После изменений в shared/entities, обновление справочника |

## Служебные

| Команда | Описание | Когда использовать |
|---------|----------|-------------------|
| `prepare` | Husky — настройка pre-commit хука | Вызывается автоматически при `npm install` |

### pre-commit хук

Выполняется при `git commit` (до создания коммита). Если любой шаг завершится с ошибкой, коммит не будет создан.

1. `npm run docs:api` — генерация API-документации
2. `git add docs/api/` — добавление сгенерированных файлов в индекс
3. `npx lint-staged` — ESLint + Prettier для staged `*.{ts,vue}` (см. `lint-staged` в package.json)

## Типичные сценарии

- **Перед коммитом:** `npm run lint:fix` + `npm run format` + `npm run test:run`
- **Перед деплоем:** `npm run build` + `npm run preview`
- **Оптимизация бандла:** `npm run build:analyze` → открыть `dist/stats.html` в браузере
